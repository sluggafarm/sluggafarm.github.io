<!DOCTYPE html>
<html>
  <head>
    <title>slugga farm</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible:wght@400;600&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="icon" type="image/x-icon" href="https://bellmorecode.com/favicon.ico">
    <style type="text/css">
        * { font-family: 'Atkinson Hyperlegible', sans-serif; } 
        body { text-align: center;  columns: 1;
               padding-left: 20vw; padding-right: 20vw; padding-top: 10vh; 
               line-height: 1.4;  font-size: 1.1em; } 
        .lead { font-size: 1.2em;}       
        figure img.farmer {border-radius: 50%;}
        h1 { font-weight: 600;}   
        a {text-decoration: none; }
        ul { list-style: none; }
        ul li { margin-bottom: 10px;}
    </style>
  </head>
  <body>
    <div class="container mt-4">
      <h1> slugga farm </h1> <figure> <img class="farmer" src="images/farmer.png" /> </figure>
      <p class="lead"> Keepin&apos; the sluggas fed. </p>
      <div class="form-group text-center connect-button-panel" id="connect-button-panel"> <button type="button" class="btn btn-primary" id="connectwalletbutton" > Connect Wallet to Play </button> </div>
      <div class="form-group text-center connected-panel" id="connected-panel" style="display:none;"> Connected as <span id="walletLabel"> ... </span> <button type="button" class="btn btn-danger btn-sm" id="disconnectwalletbutton" > Disconnect </button> </div>
    </div>
    <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js" type="application/javascript"></script>
    <script type="text/javascript">
        var sluggaapp = {
          wallets : [], 
          onload: function () {
            let wallet = "";
            console.log('loading slugga app...');
            if (window.localStorage) {
                wallet = window.localStorage.getItem('SluggaFarm_MRU_Wallet');  
            }          
            // apply event handlers
            document.getElementById('connectwalletbutton').addEventListener("click", function () {
                  sluggaapp.connectWallet();
            });
            document.getElementById('disconnectwalletbutton').addEventListener("click", function () {
                  sluggaapp.disconnectWallet();
            });
          },
          disconnectWallet : function () {
            window.localStorage.setItem('SluggaFarm_MRU_Wallet', "");
            sluggaapp.wallets = [];
            document.getElementById('connect-button-panel').style.display="";
            document.getElementById('connected-panel').style.display="none";
          },
          connectWallet: function () {
              if (window.ethereum) {
                  let eth = window.ethereum;
                  eth.request({ method: 'eth_requestAccounts' })
                      .then(walletsdata => {
                          sluggaapp.wallets = walletsdata;
                          if (window.localStorage) {
                              window.localStorage.setItem('SluggaFarm_MRU_Wallet', walletsdata[0]);
                          }
                          
                          document.getElementById('walletLabel').innerText = sluggaapp.wallets[0];
                          document.getElementById('connect-button-panel').style.display="none";
                          document.getElementById('connected-panel').style.display="";
                      })
                      .catch(err => { 
                          alert(err.message);
                      });
              } else {
                  alert('cannot connect to MetaMask plugin.');
              }
          }
        }
        window.setTimeout(function () { sluggaapp.onload(); }, 125);
    </script>
  </body>
</html>
